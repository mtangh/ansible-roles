---
# test-teardown tasks file

- block:

  - name: "{{ test_casename|d('noname') }} | test-terdown | validate"
    shell: |
      if [ -d "{{ test_expects_dir }}" ]
      then
        diff -Nur -x '.gitkeep' -I '^# Ansible managed:.*$' \
          "{{ test_expects_dir }}" "{{ test_prefixdir }}"
      else
        /bin/true
      fi
    register: test_teardown_result
    ignore_errors: "{{ test_teardown_ignore_invalid|d(false) }}"

  when: test_run|d(false)
  tags:
  - '[test-teardown]'

