---
# test-teardown tasks file

- block:

  - name: "{{ test_casename|d('noname') }} | test-terdown | validate"
    shell: |
      diff -Nur -x '.gitkeep' -I '^# Ansible managed:.*$' \
        "{{ '%s/%s'|format(test_expects_dir,test_casename) }}" \
        "{{ test_prefix_dir }}"
    when: ('%s/%s'|format(test_expects_dir,test_casename))|is_dir
    register: test_teardown_validate
    changed_when: no
    ignore_errors: yes
    no_log: "{{ ('%s/%s'|format(test_expects_dir,test_casename))|is_dir == false }}"

  when: test_run|d(false)
  tags:
  - '[test-teardown]'

