---
- hosts: localhost
  connection: local
  gather_facts: no

  tags:
    01_default

  vars_files:
  - os-spec.yml

  vars:
    
  roles:
  - test-setup
  - { role: ../.. }
  - test-teardown

- hosts: localhost
  connection: local
  gather_facts: no

  tags:
    02_default-overwrite

  vars_files:
  - os-spec.yml

  vars:

    logrotate_conf_default:
      cycle: weekly
      rotate: 8
      size: 1024M
      minsize: 1M
      dateext: yes
      dateformat: '%Y%m%d'
      compress: yes
      compressext: .gz
      delaycompress: yes
      missingok: yes
      ifempty: yes
      create:
        mode: 0644
        owner: root
        group: wheel

    logrotate_logfiles_appends:
    - name: httpd
      logfiles: '/var/log/httpd/*log'
      missingok: yes
      ifempty: no
      sharedscripts: yes
      postrotate: '/sbin/service httpd reload >/dev/null 2>/dev/null ||true' 

  roles:
  - test-setup
  - { role: ../.., tags: ['logrotate','logrotate-logfile-extend'] }
  - test-teardown

- hosts: localhost
  connection: local
  gather_facts: no

  tags:
    03_files-appends-only

  vars_files:
  - os-spec.yml

  vars:

    logrotate_logfiles_appends:
    - name: httpd
      logfiles: '/var/log/httpd/*log'
      missingok: yes
      ifempty: no
      sharedscripts: yes
      postrotate: '/sbin/service httpd reload >/dev/null 2>/dev/null ||true' 

  roles:
  - test-setup
  - { role: ../.., tags: ['logrotate-logfile-appends'] }
  - test-teardown

