# /etc/hosts
# {{ ansible_managed }}
{%  import 'macros.hosts.j2' as m_hosts with context %}
{%  set hostname_and_fqdn = ""  %}
{%  set hostname_and_fqdn = "%s %s"|format(ansible_fqdn,hostname_and_fqdn)|trim
      if ansible_fqdn|d('') not in ['localhost','localhost.localdomain'] %}
{%  set hostname_and_fqdn = "%s %s"|format(ansible_hostname,hostname_and_fqdn)|trim
      if ansible_hostname|d('') not in ['localhost','localhost.localdomain',ansible_fqdn] %}

### Loopback
{%  set localhosts = "%s localhost localhost.localdomain"|format(hostname_and_fqdn)|trim %}
127.0.0.1           {{ localhosts }} localhost4 localhost4.localdomain4
{%  if etc_hosts_using_ipv6|d(true) == true -%}
::1                 {{ localhosts }} localhost6 localhost6.localdomain6
{%- endif %}

### IPv4
{%  if etc_hosts_using_ip_by_hostname|d(true) == true
    and hostname_and_fqdn|d(none) is string
    and ansible_all_ipv4_addresses|d(none) is iterable %}
{%    for ipaddr in ansible_all_ipv4_addresses
          if ipaddr != "127.0.0.1" %}
{{ "%-19s %s %s"|format(ipaddr,ansible_hostname,ansible_fqdn)|trim }}
{%    endfor %}
{%  endif %}
{%  if etc_hosts_ipv4|d(none) is iterable %}

{{  m_hosts.dump( etc_hosts_ipv4 ) }}
{%- endif %}
{%  if etc_hosts_using_ipv6|d(true) == true %}

### IPv6
ff02::1             ip6-allnodes
ff02::2             ip6-allrouters
{%  endif %}
{%  if etc_hosts_using_ipv6|d(true) == true
    and etc_hosts_using_ip_by_hostname|d(true) == true
    and hostname_and_fqdn is string
    and ansible_all_ipv6_addresses is iterable %}

{%    for ipaddr in ansible_all_ipv6_addresses %}
{{ "%-39s %s %s"|format(ipaddr,ansible_hostname,ansible_fqdn)|trim }}
{%    endfor %}
{%  endif %}
{%  if etc_hosts_using_ipv6|d(true) == true
    and etc_hosts_ipv6|d(none) is iterable %}

{{  m_hosts.dump( etc_hosts_ipv6, is_ipv6=true ) }}
{%- endif %}

